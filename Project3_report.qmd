---
title: "Classification problems: bigfoot"
subtitle: "Project 3"
author: 
 - name: Zaide Montes
   affiliations:
     - name: Lund University
       department: Department of Biology
       address: Sölvegatan 12, S-223 62 Lund, Sweden
 - name: Dmytro Perepolkin
   affiliations:
     - name: Lund University
       department: Centre for Environmental and Climate Science
       address: Sölvegatan 37, S-223 62 Lund, Sweden
bibliography: Project3_bigfoot.bib
format: 
  titlepage-pdf:
    documentclass: scrbook
    classoption: ["oneside", "open=any"]
    number-sections: true
    titlepage: classic-lined 
    titlepage-logo: "img/logo.png"
    titlepage-footer: |
      Group 1
      Lund University\
      Lund, Sweden\
      [https://lu.se](https://lu.se)\
    titlepage-theme:
      elements: ["\\titleblock", "\\authorblock", "\\vfill", "\\logoblock", "\\footerblock"]
      page-align: "center"
      title-style: "doublelinewide"
      title-fontsize: 30
      title-fontstyle: "uppercase"
      title-space-after: "0.1\\textheight"
      subtitle-fontstyle: ["Large", "textit"]
      author-style: "plain"
      author-sep: "\\hskip1em"
      author-fontstyle: "Large"
      author-space-after: "2\\baselineskip"
      affiliation-style: "numbered-list-with-correspondence"
      affiliation-fontstyle: "large"
      affiliation-space-after: "0pt"
      footer-style: "plain"
      footer-fontstyle: ["large", "textsc"]
      footer-space-after: "0pt"
      logo-size: "0.25\\textheight"
      logo-space-after: "1cm"
fig-height: 5
fig-width: 7
fig-align: "center"
---

```{r setup, message=FALSE}
#| message: false
#install.packages("corrgram")
library(MASS) # for LDA
library(tidyverse)
library(broom)
library(corrgram) # visualisation of correlations
library(lmtest)  # more linear regression tools
library(hrbrthemes) #ggplot styling
library(GGally) # Pair plot
library(ggplot2) # ggplot 2
library(hrbrthemes) # theme for ggplot
library(kableExtra)
library(leaps)
library(glmnet)
library(patchwork)
library(plotmo)
library(randomForest) # for random forest chapter
library(pls) # for principal component regression
library(rsample) # for cross-validation
library(modelr) # evaluation of models
library(splines)

ggplot2::theme_set(theme_classic())

extrafont::loadfonts(device = "all", quiet = TRUE)

knitr::opts_chunk$set(dev = 'png')
options(device = function(file, width, height) {
  png(tempfile(), width = width, height = height)
})
```

```{r}
#| eval: false
bigfoot_original <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-13/bigfoot.csv", show_col_types = FALSE)

bigfoot <- bigfoot_original %>%
# Select the relevant covariates:
select(classification , observed , longitude , latitude , visibility) %>%
# Remove observations of class C ( second - or third hand accounts ):
filter(classification != "Class C") %>%
# Turn into 0/1, 1 = Class A, 0 = Class B:
mutate(class = ifelse(classification == "Class A", 1, 0)) %>%
# Create new indicator variables for some words from the description:
mutate(fur = grepl("fur", observed),
howl = grepl("howl", observed),
saw = grepl("saw", observed),
heard = grepl("heard", observed )) %>%
# Remove unnecessary variables:
dplyr::select(-c("classification", "observed")) %>%
# Remove any rows that contain missing values:
drop_na()

write_csv(bigfoot, "data/bigfoot.csv")

```


# Regression and tree-based models

## Introduction

### Data description

The Bigfoot Field Researchers Organization (BFRO) is an organization dedicated to investigating the bigfoot mystery, and for years they have been collecting reported sightings in a database. They manually classify their reports into

- Class A: Clear sightings in circumstances where misinterpretation or misidentification of other animals can be ruled out with greater confidence
- Class B: Incidents where a possible bigfoot was observed at a great distance or in poor lighting conditions and incidents in any other circumstance that did not afford a clear view of the subject.

However, they wonder if this can be automated and done by a classification algorithm instead. So in this task, you will set up a few different classification algorithms for this aim, and evaluate their performance.

In this task we are using a slightly simplified version of the data set where we have extracted some variables of interest and deleted observations that are missing any of these variables of interest.

```{r}
#| echo: true
bigfoot <- read_csv("data/bigfoot.csv", show_col_types = FALSE) %>% 
  mutate(class=factor(class, levels=c(1,0), labels=c("Class A", "Class B")))
```

```{r}

set.seed(42)
train_idx <- sample(1:nrow(bigfoot), nrow(bigfoot)*0.7)
test_idx <- (-train_idx)
```


## Logistic regression
Zaide 

## Random Forest

```{r}
rf_mod <- randomForest(class~., data=bigfoot, subset=train_idx, importance=TRUE)
varImpPlot(rf_mod)
```


## LDA/QDA
We build a classifier for the `class` variable of the `bigfoot` dataset.

```{r}
lda_mod1 <- lda(class~saw+longitude+latitude, data=bigfoot, subset = train_idx)
```

Because this classification task includes discrimination between the two classes only, then there will be only a single set of LD values, which will separate the classes.

We can now predict the class on the test (holdout) data.

```{r}
lda_pred1 <- predict(lda_mod1, newdata=bigfoot[test_idx,])

table(
  lda_pred1$class, bigfoot$class[test_idx],
  dnn=c("predicted", "observed")
) %>% prop.table()

```


## SVM
Dmytro


# References
